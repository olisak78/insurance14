# Default values for developer-portal-backend
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: atom-cfs-docker.common.repositories.cloud.sap/dev/amit/developer-portal/backend
  pullPolicy: Always
  tag: "1.0.11"

initData:
  image:
    repository: atom-cfs-docker.common.repositories.cloud.sap/dev/amit/developer-portal/init-data
    tag: "1.0.6"

imagePullSecrets:
  - name: gcr-registry
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 7008
  targetPort: 7008

ingress:
  enabled: true
  # Gardener-managed hostname (environment.service.app.domain pattern)
  host: dev.backend.developer-portal.cfs.c.eu-de-2.cloud.sap
  # Gardener-managed TLS certificate (auto-created)
  tlsSecretName: developer-portal-backend-tls
  # Additional annotations (Gardener-specific ones are in template)
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # Add any other custom annotations here

resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

livenessProbe:
  httpGet:
    path: /health
    port: 7008
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: 7008
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - developer-portal-backend
          topologyKey: kubernetes.io/hostname

# Application Configuration
config:
  environment: "production"
  deployEnvironment: "local"
  port: "7008"
  logLevel: "info"
  allowedOrigins:
    - "*"  # TODO: Update with actual frontend URL after frontend deployment

# Auth Configuration
auth:
  # OAuth redirect URL - must match your backend's public URL
  # OAuth callback will be: {redirectUrl}/api/auth/{provider}/handler/frame
  redirectUrl: "https://dev.backend.developer-portal.cfs.c.eu-de-2.cloud.sap"

# Database Configuration
database:
  # Use internal PostgreSQL subchart
  useExternal: false
  # External database settings (used when useExternal: true)
  external:
    host: ""
    port: "5432"
    name: "developer_portal"
    user: "postgres"
    password: ""
  # SSL Mode: "disable" for simple password auth without TLS
  sslMode: "disable"

# JWT Configuration
jwt:
  secret: "change-me-in-production"

# LDAP Configuration
ldap:
  host: "ldap.example.com"
  port: "636"
  bindDN: "CN=ServiceAccount,OU=Users,DC=example,DC=com"
  bindPassword: "change-me"
  baseDN: "DC=example,DC=com"
  insecureSkipVerify: false
  timeoutSec: 10

# Jira Configuration
jira:
  domain: "jira.example.com"
  user: "service-account@example.com"
  password: "change-me"

# Sonar Configuration
sonar:
  host: "https://sonarqube.example.com"
  token: "change-me"

# GitHub OAuth Configuration
github:
  tools:
    clientId: "change-me"
    clientSecret: "change-me"
    enterpriseBaseUrl: "https://github.tools.sap"
  wdf:
    clientId: "change-me"
    clientSecret: "change-me"
    enterpriseBaseUrl: "https://github.wdf.sap.corp"

# OAuth Encryption
oauth:
  encryptionKey: "change-me-in-production"

# Jenkins Configuration
jenkins:
  pUser: "change-me"
  atomJaasToken: "change-me"
  gkecfsmulticis2JaasToken: "change-me"
  atomperfJaasToken: "change-me"
  # Set to true to skip TLS certificate verification for SAP internal CAs
  insecureSkipVerify: true

# AI Core Configuration
# Credentials as JSON array - will be exposed as AI_CORE_CREDENTIALS env variable
# IMPORTANT: All fields are required for each credential entry
aiCore:
  credentials: []
    # Example:
    # - team: "team-name"                                    # Team name (must match team in DB)
    #   clientId: "your-client-id"                           # AI Core OAuth client ID
    #   clientSecret: "your-client-secret"                   # AI Core OAuth client secret
    #   oauthUrl: "https://your-tenant.authentication.sap.hana.ondemand.com/oauth/token"  # OAuth token URL
    #   apiUrl: "https://api.ai.prod.eu-central-1.aws.ml.hana.ondemand.com"               # AI Core API URL
    #   resourceGroup: "default"                             # AI Core resource group
    # - team: "another-team"
    #   clientId: "another-client-id"
    #   clientSecret: "another-client-secret"
    #   oauthUrl: "https://your-tenant.authentication.sap.hana.ondemand.com/oauth/token"
    #   apiUrl: "https://api.ai.prod.eu-central-1.aws.ml.hana.ondemand.com"
    #   resourceGroup: "default"

# PostgreSQL subchart configuration
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnamilegacy/postgresql
    tag: 16.3.0-debian-12-r9
  auth:
    username: postgres
    password: "change-me-in-production"
    database: developer_portal
  # Init container image (volume permissions) - use legacy
  volumePermissions:
    enabled: true
    image:
      registry: docker.io
      repository: bitnamilegacy/os-shell
      tag: 12-debian-12-r30
  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: ""
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 512Mi
  metrics:
    enabled: false

